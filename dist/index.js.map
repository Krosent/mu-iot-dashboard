{"version":3,"sources":["app.js","index.js"],"names":["solidNodeClient","require","SolidFileClient","express","html","app","client","SolidNodeClient","fileClient","fs","get","_","res","set","login","idp","username","password","getSession","then","session","console","log","JSON","stringify","info","webId","catch","error","status","send","req","params","isLoggedIn","fileLink","file","readFile","fl","writeFile","flag","err","includeNewAutomationsFile","write","end","module","exports","port","listen"],"mappings":"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","file":"index.js","sourceRoot":"../src","sourcesContent":["const solidNodeClient = require('solid-node-client');\nconst SolidFileClient = require('solid-file-client');\n\nconst express = require('express');\n\n// const axios = require('axios');\n\n// import { getFile, isRawData, getContentType, getSourceUrl, } from \"@inrupt/solid-client\";\n\nconst html = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <title>A JavaScript project</title>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n</head>\n<body>\n  <h1>A JavaScript project</h1>\n</body>\n</html>`;\n\nconst app = express();\nconst client = new solidNodeClient.SolidNodeClient();\nconst fileClient = new SolidFileClient(client);\nconst fs = require('fs');\n\napp.get('/', async (_, res) => {\n  res.set('Content-Type', 'text/html');\n  await client.login({\n    idp: 'https://solidcommunity.net', // e.g. https://solidcommunity.net\n    username: 'iot-solid-bot',\n    password: 'kDLpdi!LK2AV84k',\n  });\n\n  /* idp: 'https://broker.pod.inrupt.com', // e.g. https://solidcommunity.net\n    username: 'iot-solid-bot',\n    password: 'kDLpdi!LK2AV84k',\n  */\n\n  /* idp: 'https://broker.pod.inrupt.com', // e.g. https://solidcommunity.net\n    username: 'krosent',\n    password: 'ggUAL#H8dxcYw6q',\n  */\n\n  // console.log(`client: ${JSON.stringify(client)}`);\n\n  client\n    .getSession()\n    .then((session) =>\n      console.log(`Session: ${JSON.stringify(session.info.webId)}`))\n    .catch((error) => console.log(`We have error: ${error}`));\n\n  res.status(200).send(html);\n});\n\napp.get('/authorize/:username/:password', async (req, res) => {\n  console.log(`username: ${req.params.username}`);\n  console.log(`password: ${req.params.password}`);\n\n  await client.login({\n    idp: 'https://solidcommunity.net', // e.g. https://solidcommunity.net\n    username: req.params.username,\n    password: req.params.password,\n  });\n  client\n    .getSession()\n    .then((session) => {\n      console.log(session);\n      if (session.isLoggedIn) {\n        // TODO: Add automations file into the server\n        // TODO: Add only if does not exist before\n        // /home/krosent/Projects/hass/core/config/automations.yaml\n\n        const fileLink = 'https://iot-solid-bot.solidcommunity.net/automations/automations.yaml';\n        try {\n          const file = fileClient.readFile(fileLink).then((fl) => {\n            fs.writeFile(`/home/krosent/Projects/hass/core/config/${req.params.username}.yaml`, fl, { flag: 'a+' }, err => {\n              if (err) {\n                console.error(err);\n                return;\n              }\n              // file written successfully\n              console.log(`automations.file for user ${req.params.username} was created`);\n\n              console.log(`automations.file for user ${req.params.username} was created`);\n\n              const includeNewAutomationsFile = `automation ${req.params.username}: !include ${req.params.username}.yaml`;\n\n              fs.writeFile('/home/krosent/Projects/hass/core/config/configuration.yaml', includeNewAutomationsFile, { flag: 'a+' }, err => {\n                if (err) {\n                  console.error(err);\n                  return;\n                }\n              });\n            });\n          });\n        } catch (err) {\n          console.log(`error is: ${err}`);\n        }\n\n        res.status(200).send('Authorized');\n      } else {\n        res.status(405).send('Unauthorized');\n      }\n    })\n    .catch((error) => res.status(405).send('Unauthorized'));\n});\n\napp.get('/automations/fetch', async (_, res) => {\n  // https://iot-solid-bot.solidcommunity.net/automations/automations.yaml\n\n  const fileLink = 'https://iot-solid-bot.solidcommunity.net/automations/automations.yaml';\n  try {\n    const file = await fileClient.readFile(fileLink);\n\n    res.write(file, 'binary');\n    res.end();\n  } catch (err) {\n    console.log(`error is: ${err}`);\n  }\n});\n\nmodule.exports = app;\n","const app = require('./app');\n\nconst port = '8888';\n\napp.listen(port, () => {\n  console.log(`Server is listening on port ${port}...`);\n});\n"]}